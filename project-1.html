<!DOCTYPE html>
<html>
  <head>
    <title>Business Process Automation</title>
    <h1 style="color:#02FF02">Business Process Automation</h1>
  </head>
  <img style="width:574; height:441px" src="workflow.png" alt="workflow"/>
  <body style="background-color:#002240; color:white;">
    <h1 style="color:#02FF02">Main Processor</h1>
    <div style="width:600px; height:300px; overflow:auto; font-family:courier"> 
<table class="table"><tr><td><div class="linenodiv" style="background-color: #454545; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div style="background: #002240"><pre style="line-height: 125%"><span></span><span style="color: #DD0000">###########</span>
<span style="color: #DD0000"># main.py #</span>
<span style="color: #DD0000">###########</span>

<span style="color: #FF8000">from</span> <span style="color: #FFFFFF">process</span> <span style="color: #FF8000">import</span> <span style="color: #FFFFFF">Connect</span>, <span style="color: #FFFFFF">Process</span>

<span style="color: #FF8000">class</span> <span style="color: #5E5EFF">Main</span>():
    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">__init__</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #FFFFFF">Connect</span>()<span style="color: #FF8000">.</span><span style="color: #FFFFFF">aw</span>() <span style="color: #DD0000"># Assign DB</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">Process</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">jotdown</span>(
            <span style="color: #02FF02">&#39;External files are being loaded. &#39;</span> <span style="color: #FF8000">+</span>\
            <span style="color: #02FF02">&#39;This may take a few minutes. &#39;</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">rate_archive</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">master_rate_alignment</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">mail_archive</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">master_mail_alignment</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reltio_rates</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">all_rates_master</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">logtime</span>()

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">processor</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">analyte</span>, <span style="color: #FFFFFF">issueid</span>, <span style="color: #FFFFFF">sleep</span> <span style="color: #FF8000">=</span> <span style="color: #FF00FF">30</span> ):
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        +-------------------------------------------------+</span>
<span style="color: #02FF02">        |             Feedback File Processor             |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        |   Argument  |            Description            |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        | (1) account | (1) Sales Hierarchy               |</span>
<span style="color: #02FF02">        | (2) analyte | (2) Rate Program or Email Address |</span>
<span style="color: #02FF02">        | (3) issueid | (3) Incorrect/Missing Rate/Email  |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #DD0000"># Reset timers</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">sleep</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">sleep</span>
        <span style="color: #DD0000"># Letting you know we&#39;ve started</span>
        <span style="color: #FFFFFF">log</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Processing account {} with analyte {} ...&#39;</span>
        <span style="color: #FFFFFF">log</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">log</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">format</span>( <span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">analyte</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">jotdown</span>( <span style="color: #FFFFFF">log</span> )
        <span style="color: #DD0000"># Commence program sequence</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">account</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">lower</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">analyte</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">split</span>( <span style="color: #02FF02">&#39;@&#39;</span> )[ <span style="color: #FF8000">-</span><span style="color: #FF00FF">1</span> ]
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">issueid</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">lower</span>()
        <span style="color: #DD0000"># Reset parameters</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #DD0000"># (1) Check cache </span>
        <span style="color: #FFFFFF">cache</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scan_cache</span>()
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">cache</span> <span style="color: #FF8000">is</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">None</span>: <span style="color: #FF8000">return</span> <span style="color: #FFFFFF">cache</span>
        <span style="color: #DD0000"># (2) Is analyte valid?</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validation</span>() :
            <span style="color: #DD0000"># (3) Find the company that is</span>
            <span style="color: #DD0000">#     associated with the analyte</span>
            <span style="color: #FFFFFF">trash</span> <span style="color: #FF8000">=</span> [] <span style="color: #DD0000"># Avoid infinite loop</span>
            <span style="color: #FFFFFF">prnts</span> <span style="color: #FF8000">=</span> [] <span style="color: #DD0000"># parent companies</span>
            <span style="color: #FFFFFF">names</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">assoc_comp</span>()
            <span style="color: #FF8000">while</span> <span style="color: #FFFFFF">names</span> :
                <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">names</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">pop</span>( <span style="color: #FF00FF">0</span> ) <span style="color: #DD0000">#LIFO queue</span>
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">trash</span> :
                    <span style="color: #FF8000">continue</span> <span style="color: #DD0000"># Skip</span>
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">prnts</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span>  <span style="color: #FF69B4">True</span>
                <span style="color: #FF8000">else</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FFFFFF">trash</span> ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">10</span> :
                    <span style="color: #FF8000">break</span> <span style="color: #DD0000"># Just give up</span>
                <span style="color: #DD0000"># (4) Search company name in AW</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">name_in_aw</span>( <span style="color: #FFFFFF">name</span> ) :
                    <span style="color: #DD0000"># (5) If found, link name to analyte</span>
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FFFFFF">name</span> )
                    <span style="color: #DD0000"># (6) Search account in hierarchy</span>
                    <span style="color: #FFFFFF">web</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">blowup_web</span>()
                    <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FFFFFF">web</span> ) :
                        <span style="color: #DD0000"># (7) If found, validate archive</span>
                        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolution</span>()
                <span style="color: #FFFFFF">trash</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">name</span> )
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                <span style="color: #FFFFFF">pars</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">assoc_comp</span>( <span style="color: #FFFFFF">name</span> )
                <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">pars</span> :
                    <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">prnts</span> :
                        <span style="color: #FFFFFF">prnts</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">comp</span> )
                    <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">names</span> :
                        <span style="color: #FFFFFF">names</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">comp</span> )
        <span style="color: #DD0000"># Check archive</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolution</span>()
</pre></div>
</td></tr></table>
    </div>
    <h1 style="color:#02FF02">Processes</h1>
    <div style="width:600px; height:300px; overflow:auto; font-family:courier">
    </div>
  </body>
</html>
