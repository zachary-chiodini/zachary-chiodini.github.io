<!DOCTYPE html>
<html>
  <head>
    <title>Business Process Automation</title>
    <h1 style="color:#02FF02">Business Process Automation</h1>
  </head>
  <img style="width:574; height:441px" src="workflow.png" alt="workflow"/>
  <body style="background-color:#002240; color:white;">
    <h1 style="color:#02FF02">Main Processor</h1>
    <div style="width:600px; height:300px; overflow:auto; font-family:courier"> 
<table class="table"><tr><td><div class="linenodiv" style="background-color: #454545; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div style="background: #002240"><pre style="line-height: 125%"><span></span><span style="color: #DD0000">###########</span>
<span style="color: #DD0000"># main.py #</span>
<span style="color: #DD0000">###########</span>

<span style="color: #FF8000">from</span> <span style="color: #FFFFFF">process</span> <span style="color: #FF8000">import</span> <span style="color: #FFFFFF">Connect</span>, <span style="color: #FFFFFF">Process</span>

<span style="color: #FF8000">class</span> <span style="color: #5E5EFF">Main</span>():
    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">__init__</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #FFFFFF">Connect</span>()<span style="color: #FF8000">.</span><span style="color: #FFFFFF">aw</span>() <span style="color: #DD0000"># Assign DB</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">Process</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">jotdown</span>(
            <span style="color: #02FF02">&#39;External files are being loaded. &#39;</span> <span style="color: #FF8000">+</span>\
            <span style="color: #02FF02">&#39;This may take a few minutes. &#39;</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">rate_archive</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">master_rate_alignment</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">mail_archive</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">master_mail_alignment</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reltio_rates</span> <span style="color: #FF8000">=</span> \
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">all_rates_master</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">logtime</span>()

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">processor</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">analyte</span>, <span style="color: #FFFFFF">issueid</span>, <span style="color: #FFFFFF">sleep</span> <span style="color: #FF8000">=</span> <span style="color: #FF00FF">30</span> ):
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        +-------------------------------------------------+</span>
<span style="color: #02FF02">        |             Feedback File Processor             |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        |   Argument  |            Description            |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        | (1) account | (1) Sales Hierarchy               |</span>
<span style="color: #02FF02">        | (2) analyte | (2) Rate Program or Email Address |</span>
<span style="color: #02FF02">        | (3) issueid | (3) Incorrect/Missing Rate/Email  |</span>
<span style="color: #02FF02">        +-------------+-----------------------------------+</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #DD0000"># Reset timers</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">sleep</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">sleep</span>
        <span style="color: #DD0000"># Letting you know we&#39;ve started</span>
        <span style="color: #FFFFFF">log</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Processing account {} with analyte {} ...&#39;</span>
        <span style="color: #FFFFFF">log</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">log</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">format</span>( <span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">analyte</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">jotdown</span>( <span style="color: #FFFFFF">log</span> )
        <span style="color: #DD0000"># Commence program sequence</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">account</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">lower</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">analyte</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">split</span>( <span style="color: #02FF02">&#39;@&#39;</span> )[ <span style="color: #FF8000">-</span><span style="color: #FF00FF">1</span> ]
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">issueid</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">lower</span>()
        <span style="color: #DD0000"># Reset parameters</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reset</span>()
        <span style="color: #DD0000"># (1) Check cache </span>
        <span style="color: #FFFFFF">cache</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scan_cache</span>()
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">cache</span> <span style="color: #FF8000">is</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">None</span>: <span style="color: #FF8000">return</span> <span style="color: #FFFFFF">cache</span>
        <span style="color: #DD0000"># (2) Is analyte valid?</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validation</span>() :
            <span style="color: #DD0000"># (3) Find the company that is</span>
            <span style="color: #DD0000">#     associated with the analyte</span>
            <span style="color: #FFFFFF">trash</span> <span style="color: #FF8000">=</span> [] <span style="color: #DD0000"># Avoid infinite loop</span>
            <span style="color: #FFFFFF">prnts</span> <span style="color: #FF8000">=</span> [] <span style="color: #DD0000"># parent companies</span>
            <span style="color: #FFFFFF">names</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">assoc_comp</span>()
            <span style="color: #FF8000">while</span> <span style="color: #FFFFFF">names</span> :
                <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">names</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">pop</span>( <span style="color: #FF00FF">0</span> ) <span style="color: #DD0000">#LIFO queue</span>
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">trash</span> :
                    <span style="color: #FF8000">continue</span> <span style="color: #DD0000"># Skip</span>
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">prnts</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span>  <span style="color: #FF69B4">True</span>
                <span style="color: #FF8000">else</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FFFFFF">trash</span> ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">10</span> :
                    <span style="color: #FF8000">break</span> <span style="color: #DD0000"># Just give up</span>
                <span style="color: #DD0000"># (4) Search company name in AW</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">name_in_aw</span>( <span style="color: #FFFFFF">name</span> ) :
                    <span style="color: #DD0000"># (5) If found, link name to analyte</span>
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FFFFFF">name</span> )
                    <span style="color: #DD0000"># (6) Search account in hierarchy</span>
                    <span style="color: #FFFFFF">web</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">blowup_web</span>()
                    <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FFFFFF">web</span> ) :
                        <span style="color: #DD0000"># (7) If found, validate archive</span>
                        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolution</span>()
                <span style="color: #FFFFFF">trash</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">name</span> )
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                <span style="color: #FFFFFF">pars</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">assoc_comp</span>( <span style="color: #FFFFFF">name</span> )
                <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">pars</span> :
                    <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">prnts</span> :
                        <span style="color: #FFFFFF">prnts</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">comp</span> )
                    <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">comp</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">names</span> :
                        <span style="color: #FFFFFF">names</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">comp</span> )
        <span style="color: #DD0000"># Check archive</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">process</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolution</span>()
</pre></div>
</td></tr></table>
    </div>
    <h1 style="color:#02FF02">Processes</h1>
    <div style="width:600px; height:300px; overflow:auto; font-family:courier">
      
1
code = """
2
##############
3
# process.py #
4
##############
5
​
6
import fuzzywuzzy as fuzz, pandas as pd
7
from trackingtools import Query, Runtime, Scrape, Tools, Verify
8
​
9
class Process() :
10
    def __init__( self ) :
11
        self.account = ''
12
        self.analyte = ''
13
        self.issueid = ''
14
        self.resolve = ''
15
        self.handoff = ''
16
        self.parents = False
17
        self.orphans = False
18
        self.linkage = pd.Series()
19
        self.archive = pd.Series()
20
        # Processing parameters
21
        self.parent_title = ''
22
        self.entity_title = ''
23
        self.validarchive = False
24
        self.analyte_arch = False
25
        self.acnt_in_arch = False
26
        self.acnt_in_link = False
27
        self.parent_in_aw = False
28
        self.entity_in_aw = False
29
        self.parentresult = pd.DataFrame()
30
        self.entityresult = pd.DataFrame()
31
        # Tracking Tools (⌐■_■)
32
        self.track  = Runtime()
33
        self.total  = Runtime()
34
        self.tools  =   Tools()
35
        self.query  =   Query()
36
        self.scrape =  Scrape()
37
        self.verify =  Verify()
38
        # Synchronizing program log
39
        self.tools.track  = self.track
40
        self.query.track  = self.track
41
        self.scrape.track = self.track
42
        self.verify.track = self.track
43
        # Cache
44
        self.links = {}
45
        self.resol = {}
46
        # External files
47
        self.rate_archive = pd.DataFrame()
48
        self.mail_archive = pd.DataFrame()
49
        self.reltio_rates = pd.DataFrame()
50
        # Information store
51
        self.info = {
52
            'Associated Account' : [], 'Assoc. Acc. in AW' : [],
53
            'Parent Account'     : [], 'Parent Acc. in AW' : [],
54
            'Found Link'         : [], 'Hierarchy'         : [],
55
            'Archived Link'      : [], 'Archived Hierarchy': [],
56
            'Resolution'         : []
57
            }
58
​
59
    def archived( self ) :
60
        '''
61
        Helper Function:
62
        Search the master alignment files for
63
        the analyte. If archived, return true.
64
        '''
65
        if 'mail' in self.issueid :
66
            rate = False
67
            colm = 'email_address_txt'
68
            find = 'DUNS'
69
            arch = self.mail_archive
70
        if 'rate' in self.issueid :
71
            rate = True
72
            colm = 'rate_program'
73
            find = 'account_uri'
74
            arch = self.rate_archive
75
        indx = arch[ colm ] == self.analyte
76
        slct = arch.loc[ indx, find ]
77
        if slct.empty: return False
78
        # Retrieve the archived links
79
        colms = [ 'CHILD_URI',
80
                  'CHILD_ACCOUNT_NM' ] 
81
        links = pd.DataFrame()
82
        for uid in slct.unique().tolist() :
83
            if rate :
84
                link = self.query.uri( uid, colms )
85
            else :
86
                link = self.query.duns( uid, colms )
87
            if not link.empty :
88
                links = links.append( link )
89
        # Store the archived links
90
        for link in links.values.tolist():
91
            link = ', '.join( link )
92
            if link not in self.info[ 'Archived Link' ] :
93
                self.info[ 'Archived Link' ].append( link )
94
        self.handoff = links
95
        return True
96
​
97
    def valid_archive( self ) :
98
        '''
99
        Helper Function:
100
        Validate the archived analyte linkage
101
        by searching the found linkage in the
102
        archived hierarchy.
103
        '''
104
        arch = self.handoff # from archived
105
        if arch.empty: # Not found in AW
106
            log  = 'Archived D-U-N-S or URI not found in AW'
107
            self.info[ 'Archived Hierarchy' ].append( log )
108
            self.info[ 'Archived Link'      ].append( log )
109
            log += ". Can't validate the archived link."
110
            self.track.jotdown( log )
111
            return False
112
        # Blow up hierarchy
113
        for indx, series in arch.iterrows() :
114
            uri = series[ 'CHILD_URI' ]
115
            web = self.query.blowup( uri, uri  = True,
116
                                     only_duns = True )
117
            # Store archived hierarchy
118
            ultm = self.query.ultm
119
            for ultm in ultm.values.tolist() :
120
                join = ', '.join( ultm )
121
                if join not in self.info[ 'Archived Hierarchy' ] :
122
                    self.info[ 'Archived Hierarchy' ].append( join )
123
            # Search the D-U-N-S number of the
124
            # linkage in the archived hierarchy
125
            if not self.linkage.empty:
126
                link = self.linkage
127
                colm = [ col for col in link.index if 'DUNS' in col ]
128
                duns = link[ colm ].iloc[ 0 ]
129
                if duns != '' :
130
                    if self.tools.duns_in_web( duns, web ) :
131
                        self.archive = series
132
                        # Search acnt in archived hierarchy
133
                        if self.tools.acnt_in_web( self.account, web ) :
134
                            self.acnt_in_arch = True
135
                        else :
136
                            # To account for orphans, search all the
137
                            # company names in the archived hierarchy
138
                            for name in self.info[ 'Associated Account' ]:
139
                                if self.tools.acnt_in_web( name, web ) :
140
                                    self.orphans = True
141
                        return True
142
            # Search acnt in archived hierarchy
143
            if self.tools.acnt_in_web( self.account, web ) :
144
                self.archive = series
145
                self.acnt_in_arch = True
146
                return True
147
            # To account for orphans, search all the
148
            # company names in the archived hierarchy
149
            for name in self.info[ 'Associated Account' ] :
150
                if self.tools.acnt_in_web( name, web ) :
151
                    self.archive = series
152
                    self.orphans = True
153
                    return True
154
        # If no link was found,
155
        # just take what's archived
156
        if self.linkage.empty :
157
            self.archive = arch.iloc[ 0 ]
158
            return True
159
        return False
160
​
161
    def validate_archive( self ) :
162
        '''
163
        Helper Function:
164
        Attempts to validate archived. If the
165
        archived link can't be validated, the
166
        archive is assumed to be valid.
167
        '''
168
        # Search archive for analyte
169
        if self.archived() :
170
            self.analyte_arch = True
171
            # Validate archive
172
            if self.valid_archive() :
173
                self.validarchive = True
174
​
175
    def has_duns( self ) :
176
        link = self.linkage
177
        for col in link.index :
178
            if 'DUNS' in col :
179
                colm = col
180
                break
181
        duns = link[ colm ]
182
        if duns : return True
183
        return False
184
​
185
    def find_linkage( self ) :
186
        '''
187
        Helper Function:
188
        If an organization was found in AW DB,
189
        then link analyte to the lowest level
190
        account. Then, provide the resolution.
191
        '''
192
        if not self.archive.empty :
193
            # Archive is valid
194
            if 'incorrect' in self.issueid :
195
                if self.linkage.empty :
196
                    self.resolve = 'Program Could Not Validate'
197
                    return
198
            self.linkage = self.archive
199
            if self.acnt_in_arch :
200
                self.resolve = 'Deny - Correctly Linked'
201
                if len( self.info[ 'Hierarchy' ] ) > 1 :
202
                    self.resolve += ' - Broken Hierarchy' 
203
            elif self.acnt_in_link :
204
                self.resolve = 'Approved'
205
                if len( self.info[ 'Hierarchy' ] ) > 1 :
206
                    self.resolve += ' - Broken Hierarchy' 
207
            else :
208
                self.resolve = 'Deny - Different Hierarchy'
209
        elif self.acnt_in_link :
210
            self.resolve = 'Approved'
211
            if self.entity_in_aw :
212
                self.handoff = self.entityresult
213
                self.link_analyte( self.entity_title )
214
                if self.parent_in_aw :
215
                    if not self.has_duns() :
216
                        self.handoff = self.parentresult
217
                        self.link_analyte( self.parent_title )
218
            elif self.parent_in_aw :
219
                self.handoff = self.parentresult
220
                self.link_analyte( self.parent_title )
221
            if len( self.info[ 'Hierarchy' ] ) > 1 :
222
                self.resolve += ' - Broken Hierarchy'
223
        elif self.entity_in_aw or self.parent_in_aw :
224
            self.resolve = 'Deny - Different Hierarchy'
225
            if self.entity_in_aw :
226
                self.handoff = self.entityresult
227
                self.link_analyte( self.entity_title )
228
            elif self.parent_in_aw :
229
                self.handoff = self.parentresult
230
                self.link_analyte( self.parent_title )
231
        if self.analyte_arch and not self.validarchive :
232
            self.resolve += ' - Delete & Relink'
233
        
234
    def link_duns( self ) :
235
        '''
236
        Helper Function:
237
        If linked account in AW does not have
238
        a D-U-N-S number, link the analyte to
239
        the ultimate parent account, instead.
240
        '''
241
        link = self.linkage
242
        for col in link.index :
243
            if 'DUNS' in col :
244
                colm = col
245
                break
246
        duns = link[ colm ]
247
        for col in link.index :
248
            if 'URI' in col :
249
                colm = col
250
                break
251
        auri = link[ colm ]
252
        if not duns :
253
            link = self.query.ult_acnt( auri, uri = True )
254
            if not link.empty :
255
                self.linkage = link.iloc[ 0 ]
256
​
257
    def scan_cache( self ) :
258
        '''
259
        First Step: Check the cache to see if
260
        data point has already been processed.
261
        '''
262
        if ( self.account,
263
             self.analyte,
264
             self.issueid ) in self.links.keys() :
265
             self.linkage = self.links[ ( self.account,
266
                                          self.analyte,
267
                                          self.issueid ) ]
268
             self.resolve = self.resol[ ( self.account,
269
                                          self.analyte,
270
                                          self.issueid ) ]
271
             # Finalize information store
272
             for key in self.info.keys():
273
                 val = self.info[ key ]
274
                 self.info[ key ] = ' | '.join( val )
275
             self.info[ 'Resolution' ] = self.resolve
276
             pd.set_option( 'display.max_colwidth', 10000 )
277
             self.info = pd.DataFrame(
278
                 index   = self.info.keys(),
279
                 data    = self.info.values(),
280
                 columns = [ 'Info' ] )
281
             # End
282
             self.track.clear()
283
             self.total.logtime()
284
             self.total.endpage()
285
             return self.resolve
286
        # If not found,
287
        return
288
​
289
    def validation( self ) :
290
        '''
291
        Second Step: Validate Rate Program by
292
        Finding it in Reltio, or Validate the
293
        Domain by Querying its MX Records.
294
        '''
295
        if 'mail' in self.issueid :
296
            if self.verify.valid_domain( self.analyte ) :
297
                return True
298
            self.resolve = 'Deny - Invalid Email Address'
299
            return False
300
        if 'rate' in self.issueid :
301
            if self.tools.valid_program( self.analyte,
302
                                    self.reltio_rates ) :
303
                return True
304
            self.resolve = 'Pending - Rate not Found in ' +\\
305
                           'Current Source HPP Data. '    +\\
306
                           'DSR will Revisit this Item.'
307
            return False
308
        raise ValueError(
309
            'The positional argument "issueid" must be ' +\\
310
            'of type string containing "rate" or "mail."' )
311
​
312
    def assoc_comp( self, name = None ):
313
        '''
314
        Third Step: Search and Seize the Name
315
        of the Organization that's Associated
316
        with the Analyte.
317
        '''
318
        if self.parents :
319
            comps = self.scrape.parent_org( name )
320
        elif 'mail' in self.issueid :
321
            comps = self.scrape.assoc_comp( self.analyte )
322
            if not comps :
323
                comps.append( self.analyte.split( '.' )[ 0 ] )
324
                comps.append( self.analyte )
325
        elif 'rate' in self.issueid :
326
            comps = self.tools.handoff # From valid_program
327
        if len( comps ) > 5 :
328
            # Don't want to spend an hour here
329
            comps = comps[ 0 : 5 ]
330
        for acnt in comps :
331
            if fuzz.QRatio( self.account, acnt ) != 100 :
332
                # Correct for minor mispellings
333
                if fuzz.QRatio( self.account, acnt ) >= 90 :
334
                    comps.append( self.account )
335
                    break
336
        if self.parents :
337
            for name in comps :
338
                if name not in self.info[ 'Parent Account' ] :
339
                    self.info[ 'Parent Account' ].append( name )
340
        else :
341
            for name in comps :
342
                if name not in self.info[ 'Associated Account' ] :
343
                    self.info[ 'Associated Account' ].append( name )
344
        return comps
345
​
346
    def name_in_aw( self, name ) :
347
        '''
348
        Fourth Step: Query name in AW to find
349
        whether it exists in the database.
350
        '''
351
        # Avoid querying small substrings
352
        if len( name ) >  6 : suff =  True
353
        else                : suff = False
354
        if len( name ) > 14 : like =  True
355
        else                : like = False
356
        # A common error is to not include
357
        # spaces or include unnecessary spaces
358
        name = name.replace( ' ', '' )
359
        if self.query.acnt_in_db( name, like = like,
360
                                  suffix  =  suff,
361
                                  spaces  = False,
362
                                  orphans =  True ) :
363
            self.handoff = self.query.handoff
364
            cols = [ col for col
365
                     in self.handoff.columns
366
                     if 'DUNS' in col ]
367
            duns = self.handoff[ cols ]
368
            duns = duns != ''
369
            duns = duns.any( axis = 1 )
370
            if not duns.any( axis = 0 ) :
371
                # Accounts not at all associated with
372
                # a D-U-N-S number are not reliable
373
                return False
374
            self.handoff = self.handoff.loc[
375
                duns.index.tolist(), : ]
376
            if self.parents :
377
                self.parent_in_aw = True
378
                self.parentresult = self.handoff
379
                self.parent_title = name
380
            else :
381
                self.entity_in_aw = True
382
                self.entityresult = self.handoff
383
                self.entity_title = name   
384
            return True
385
        # Not in AW
386
        return False
387
​
388
    def link_analyte( self, name ):
389
        '''
390
        Fifth Step: Link analyte to best name
391
        match in AW at the highest level
392
        '''
393
        name = name.replace( ' ', '' )
394
        query = self.handoff
395
        link  = self.tools.lowest_level_deduped(
396
            name, query, spaces = False
397
            )
398
        self.linkage = link
399
​
400
    def blowup_web( self ) :
401
        '''
402
        Sixth Step: Blowup sales hierarchy of
403
        the linked organization name
404
        '''
405
        link = self.linkage
406
        # Retrieve name as it is written in AW
407
        for col in link.index :
408
            if 'NM' in col :
409
                colm = col
410
                break
411
        acnt = link[ colm ]
412
        # Store name
413
        if self.parents :
414
            if acnt not in self.info[ 'Parent Acc. in AW' ] :
415
                self.info[ 'Parent Acc. in AW' ].append( acnt )
416
        else :
417
            if acnt not in self.info[ 'Assoc. Acc. in AW' ]:
418
                self.info[ 'Assoc. Acc. in AW' ].append( acnt )
419
        # Blow up hierarchy
420
        web = self.query.blowup( acnt, only_duns = True,
421
                                 orphans = True )
422
        # Store hierarchy
423
        for ultm in self.query.ultm.values.tolist():
424
            ultm = ', '.join( ultm )
425
            if ultm not in self.info[ 'Hierarchy' ] :
426
                self.info[ 'Hierarchy' ].append( ultm )
427
        return web
428
​
429
    def acnt_in_web( self, web ) :
430
        '''
431
        Seventh Step: Search the account name
432
        in the sales hierarchy of linked name.
433
        Web is short for hierarchy.
434
        '''
435
        if web.empty : return False
436
        name = self.account.replace( ' ', '' )
437
        if self.tools.acnt_in_web( name, web,
438
                                   spaces = False ) :
439
            self.acnt_in_link = True
440
            return True
441
        return False
442
​
443
    def resolution( self ) :
444
        '''
445
        Last Step: Check the archive file and
446
        validate link, append cache with link
447
        resolution, "wrap up" the information
448
        store, and then return the resolution.
449
        '''
450
        # Check and, if link was found,
451
        # validate archive
452
        self.validate_archive()
453
        # Find you a link!
454
        self.find_linkage()
455
        # Store found linkage
456
        if self.linkage.empty :
457
            self.linkage = 'Program Could Not Find Link'
458
            self.info[ 'Found Link' ].append( self.linkage )
459
        else :
460
            self.link_duns()
461
            link = ', '.join( self.linkage.tolist() )
462
            self.info[ 'Found Link' ].append( link )
463
            # If link has no D-U-N-S number,
464
            # contact account deployment.
465
            for col in self.linkage.index :
466
                if 'DUNS' in col :
467
                    colm = col
468
                    break
469
            if self.linkage[ colm ] == '' :
470
                self.resolve += ' - Contact Account Deployment'
471
        if not self.resolve :
472
            self.resolve = 'Program Could Not Validate'
473
        # Append cache
474
        self.links[ ( self.account,
475
                      self.analyte,
476
                      self.issueid )
477
                  ] = self.linkage
478
        self.resol[ ( self.account,
479
                      self.analyte,
480
                      self.issueid )
481
                  ] = self.resolve
482
        # Finalize information store
483
        for key in self.info.keys():
484
            val = self.info[ key ]
485
            self.info[ key ] = ' | '.join( val )
486
        self.info[ 'Resolution' ] = self.resolve
487
        pd.set_option( 'display.max_colwidth', 10000 )
488
        self.info = pd.DataFrame(
489
            index   = self.info.keys(),
490
            data    = self.info.values(),
491
            columns = [ 'Info' ] )
492
        # End
493
        self.track.clear()
494
        self.total.logtime()
495
        self.total.endpage()
496
        return self.resolve
497
​
498
    def reset( self ) :
499
        '''
500
        Helper Function:
501
        Reset processing parameters.
502
        '''
503
        self.resolve = ''
504
        self.handoff = ''
505
        self.parents = False
506
        self.orphans = False
507
        self.linkage = pd.Series()
508
        self.archive = pd.Series()
509
        self.parent_title = ''
510
        self.entity_title = ''
511
        self.analyte_arch = False
512
        self.validarchive = False
513
        self.acnt_in_arch = False
514
        self.acnt_in_link = False
515
        self.parent_in_aw = False
516
        self.entity_in_aw = False
517
        self.parentresult = pd.DataFrame()
518
        self.entityresult = pd.DataFrame()
519
        self.info = {
520
            'Associated Account' : [], 'Assoc. Acc. in AW' : [],
521
            'Parent Account'     : [], 'Parent Acc. in AW' : [],
522
            'Found Link'         : [], 'Hierarchy'         : [],
523
            'Archived Link'      : [], 'Archived Hierarchy': [],
524
            'Resolution'         : []
525
            }
526
"""
1
print( highlight( code, PythonLexer(), formatter ).replace( '#f0f0f0', '#454545' ) )
<table class="table"><tr><td><div class="linenodiv" style="background-color: #454545; padding-right: 10px"><pre style="line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524</pre></div></td><td class="code"><div style="background: #002240"><pre style="line-height: 125%"><span></span><span style="color: #DD0000">##############</span>
<span style="color: #DD0000"># process.py #</span>
<span style="color: #DD0000">##############</span>

<span style="color: #FF8000">import</span> <span style="color: #FFFFFF">fuzzywuzzy</span> <span style="color: #FF8000">as</span> <span style="color: #FFFFFF">fuzz</span><span style="color: #FF8000">,</span> <span style="color: #FFFFFF">pandas</span> <span style="color: #FF8000">as</span> <span style="color: #FFFFFF">pd</span>
<span style="color: #FF8000">from</span> <span style="color: #FFFFFF">trackingtools</span> <span style="color: #FF8000">import</span> <span style="color: #FFFFFF">Query</span>, <span style="color: #FFFFFF">Runtime</span>, <span style="color: #FFFFFF">Scrape</span>, <span style="color: #FFFFFF">Tools</span>, <span style="color: #FFFFFF">Verify</span>

<span style="color: #FF8000">class</span> <span style="color: #5E5EFF">Process</span>() :
    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">__init__</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">Series</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">Series</span>()
        <span style="color: #DD0000"># Processing parameters</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_title</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validarchive</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entityresult</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #DD0000"># Tracking Tools (⌐■_■)</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>  <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">Runtime</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span>  <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">Runtime</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span>  <span style="color: #FF8000">=</span>   <span style="color: #FFFFFF">Tools</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span>  <span style="color: #FF8000">=</span>   <span style="color: #FFFFFF">Query</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span> <span style="color: #FF8000">=</span>  <span style="color: #FFFFFF">Scrape</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">verify</span> <span style="color: #FF8000">=</span>  <span style="color: #FFFFFF">Verify</span>()
        <span style="color: #DD0000"># Synchronizing program log</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>  <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>  <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">verify</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span>
        <span style="color: #DD0000"># Cache</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">links</span> <span style="color: #FF8000">=</span> {}
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resol</span> <span style="color: #FF8000">=</span> {}
        <span style="color: #DD0000"># External files</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">rate_archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">mail_archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reltio_rates</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #DD0000"># Information store</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span> <span style="color: #FF8000">=</span> {
            <span style="color: #02FF02">&#39;Associated Account&#39;</span> : [], <span style="color: #02FF02">&#39;Assoc. Acc. in AW&#39;</span> : [],
            <span style="color: #02FF02">&#39;Parent Account&#39;</span>     : [], <span style="color: #02FF02">&#39;Parent Acc. in AW&#39;</span> : [],
            <span style="color: #02FF02">&#39;Found Link&#39;</span>         : [], <span style="color: #02FF02">&#39;Hierarchy&#39;</span>         : [],
            <span style="color: #02FF02">&#39;Archived Link&#39;</span>      : [], <span style="color: #02FF02">&#39;Archived Hierarchy&#39;</span>: [],
            <span style="color: #02FF02">&#39;Resolution&#39;</span>         : []
            }

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">archived</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        Search the master alignment files for</span>
<span style="color: #02FF02">        the analyte. If archived, return true.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;mail&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FFFFFF">rate</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
            <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;email_address_txt&#39;</span>
            <span style="color: #FFFFFF">find</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;DUNS&#39;</span>
            <span style="color: #FFFFFF">arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">mail_archive</span>
        <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;rate&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FFFFFF">rate</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
            <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;rate_program&#39;</span>
            <span style="color: #FFFFFF">find</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;account_uri&#39;</span>
            <span style="color: #FFFFFF">arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">rate_archive</span>
        <span style="color: #FFFFFF">indx</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">arch</span>[ <span style="color: #FFFFFF">colm</span> ] <span style="color: #FF8000">==</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>
        <span style="color: #FFFFFF">slct</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">arch</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">loc</span>[ <span style="color: #FFFFFF">indx</span>, <span style="color: #FFFFFF">find</span> ]
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">slct</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span>: <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
        <span style="color: #DD0000"># Retrieve the archived links</span>
        <span style="color: #FFFFFF">colms</span> <span style="color: #FF8000">=</span> [ <span style="color: #02FF02">&#39;CHILD_URI&#39;</span>,
                  <span style="color: #02FF02">&#39;CHILD_ACCOUNT_NM&#39;</span> ] 
        <span style="color: #FFFFFF">links</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">uid</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">slct</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">unique</span>()<span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>() :
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">rate</span> :
                <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">uri</span>( <span style="color: #FFFFFF">uid</span>, <span style="color: #FFFFFF">colms</span> )
            <span style="color: #FF8000">else</span> :
                <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">duns</span>( <span style="color: #FFFFFF">uid</span>, <span style="color: #FFFFFF">colms</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
                <span style="color: #FFFFFF">links</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">links</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">link</span> )
        <span style="color: #DD0000"># Store the archived links</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">links</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">values</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>():
            <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;, &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FFFFFF">link</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Link&#39;</span> ] :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Link&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">link</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">links</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">valid_archive</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        Validate the archived analyte linkage</span>
<span style="color: #02FF02">        by searching the found linkage in the</span>
<span style="color: #02FF02">        archived hierarchy.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FFFFFF">arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #DD0000"># from archived</span>
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">arch</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span>: <span style="color: #DD0000"># Not found in AW</span>
            <span style="color: #FFFFFF">log</span>  <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Archived D-U-N-S or URI not found in AW&#39;</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Hierarchy&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">log</span> )
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Link&#39;</span>      ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">log</span> )
            <span style="color: #FFFFFF">log</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&quot;. Can&#39;t validate the archived link.&quot;</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">jotdown</span>( <span style="color: #FFFFFF">log</span> )
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
        <span style="color: #DD0000"># Blow up hierarchy</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">indx</span>, <span style="color: #FFFFFF">series</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">arch</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">iterrows</span>() :
            <span style="color: #FFFFFF">uri</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">series</span>[ <span style="color: #02FF02">&#39;CHILD_URI&#39;</span> ]
            <span style="color: #FFFFFF">web</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">blowup</span>( <span style="color: #FFFFFF">uri</span>, <span style="color: #FFFFFF">uri</span>  <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>,
                                     <span style="color: #FFFFFF">only_duns</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span> )
            <span style="color: #DD0000"># Store archived hierarchy</span>
            <span style="color: #FFFFFF">ultm</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">ultm</span>
            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">ultm</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">ultm</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">values</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>() :
                <span style="color: #FFFFFF">join</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;, &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FFFFFF">ultm</span> )
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">join</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Hierarchy&#39;</span> ] :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Archived Hierarchy&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">join</span> )
            <span style="color: #DD0000"># Search the D-U-N-S number of the</span>
            <span style="color: #DD0000"># linkage in the archived hierarchy</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span>:
                <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>
                <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> [ <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;DUNS&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> ]
                <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>[ <span style="color: #FFFFFF">colm</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">iloc</span>[ <span style="color: #FF00FF">0</span> ]
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">!=</span> <span style="color: #02FF02">&#39;&#39;</span> :
                    <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">duns_in_web</span>( <span style="color: #FFFFFF">duns</span>, <span style="color: #FFFFFF">web</span> ) :
                        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">series</span>
                        <span style="color: #DD0000"># Search acnt in archived hierarchy</span>
                        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">web</span> ) :
                            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                        <span style="color: #FF8000">else</span> :
                            <span style="color: #DD0000"># To account for orphans, search all the</span>
                            <span style="color: #DD0000"># company names in the archived hierarchy</span>
                            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Associated Account&#39;</span> ]:
                                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FFFFFF">name</span>, <span style="color: #FFFFFF">web</span> ) :
                                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
            <span style="color: #DD0000"># Search acnt in archived hierarchy</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">web</span> ) :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">series</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
            <span style="color: #DD0000"># To account for orphans, search all the</span>
            <span style="color: #DD0000"># company names in the archived hierarchy</span>
            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Associated Account&#39;</span> ] :
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FFFFFF">name</span>, <span style="color: #FFFFFF">web</span> ) :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">series</span>
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                    <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
        <span style="color: #DD0000"># If no link was found,</span>
        <span style="color: #DD0000"># just take what&#39;s archived</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">arch</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">iloc</span>[ <span style="color: #FF00FF">0</span> ]
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">validate_archive</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        Attempts to validate archived. If the</span>
<span style="color: #02FF02">        archived link can&#39;t be validated, the</span>
<span style="color: #02FF02">        archive is assumed to be valid.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #DD0000"># Search archive for analyte</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archived</span>() :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
            <span style="color: #DD0000"># Validate archive</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">valid_archive</span>() :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validarchive</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">has_duns</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> :
            <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;DUNS&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> :
                <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">col</span>
                <span style="color: #FF8000">break</span>
        <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>[ <span style="color: #FFFFFF">colm</span> ]
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">duns</span> : <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">find_linkage</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        If an organization was found in AW DB,</span>
<span style="color: #02FF02">        then link analyte to the lowest level</span>
<span style="color: #02FF02">        account. Then, provide the resolution.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
            <span style="color: #DD0000"># Archive is valid</span>
            <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;incorrect&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Program Could Not Validate&#39;</span>
                    <span style="color: #FF8000">return</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_arch</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Deny - Correctly Linked&#39;</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Hierarchy&#39;</span> ] ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">1</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&#39; - Broken Hierarchy&#39;</span> 
            <span style="color: #FF8000">elif</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_link</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Approved&#39;</span>
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Hierarchy&#39;</span> ] ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">1</span> :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&#39; - Broken Hierarchy&#39;</span> 
            <span style="color: #FF8000">else</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Deny - Different Hierarchy&#39;</span>
        <span style="color: #FF8000">elif</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_link</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Approved&#39;</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entityresult</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_title</span> )
                <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> :
                    <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">has_duns</span>() :
                        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span>
                        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> )
            <span style="color: #FF8000">elif</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Hierarchy&#39;</span> ] ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">1</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&#39; - Broken Hierarchy&#39;</span>
        <span style="color: #FF8000">elif</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> <span style="color: #FF8000">or</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Deny - Different Hierarchy&#39;</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entityresult</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_title</span> )
            <span style="color: #FF8000">elif</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_analyte</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> )
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte_arch</span> <span style="color: #FF8000">and</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validarchive</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&#39; - Delete &amp; Relink&#39;</span>
        
    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">link_duns</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        If linked account in AW does not have</span>
<span style="color: #02FF02">        a D-U-N-S number, link the analyte to</span>
<span style="color: #02FF02">        the ultimate parent account, instead.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> :
            <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;DUNS&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> :
                <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">col</span>
                <span style="color: #FF8000">break</span>
        <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>[ <span style="color: #FFFFFF">colm</span> ]
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> :
            <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;URI&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> :
                <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">col</span>
                <span style="color: #FF8000">break</span>
        <span style="color: #FFFFFF">auri</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>[ <span style="color: #FFFFFF">colm</span> ]
        <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FFFFFF">duns</span> :
            <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">ult_acnt</span>( <span style="color: #FFFFFF">auri</span>, <span style="color: #FFFFFF">uri</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">iloc</span>[ <span style="color: #FF00FF">0</span> ]

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">scan_cache</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        First Step: Check the cache to see if</span>
<span style="color: #02FF02">        data point has already been processed.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> ( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>,
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> ) <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">links</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">keys</span>() :
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">links</span>[ ( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>,
                                          <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
                                          <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> ) ]
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resol</span>[ ( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>,
                                          <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
                                          <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> ) ]
             <span style="color: #DD0000"># Finalize information store</span>
             <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">key</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">keys</span>():
                 <span style="color: #FFFFFF">val</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #FFFFFF">key</span> ]
                 <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #FFFFFF">key</span> ] <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39; | &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FFFFFF">val</span> )
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Resolution&#39;</span> ] <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span>
             <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">set_option</span>( <span style="color: #02FF02">&#39;display.max_colwidth&#39;</span>, <span style="color: #FF00FF">10000</span> )
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>(
                 <span style="color: #FFFFFF">index</span>   <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">keys</span>(),
                 <span style="color: #FFFFFF">data</span>    <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">values</span>(),
                 <span style="color: #FFFFFF">columns</span> <span style="color: #FF8000">=</span> [ <span style="color: #02FF02">&#39;Info&#39;</span> ] )
             <span style="color: #DD0000"># End</span>
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">clear</span>()
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">logtime</span>()
             <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">endpage</span>()
             <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span>
        <span style="color: #DD0000"># If not found,</span>
        <span style="color: #FF8000">return</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">validation</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Second Step: Validate Rate Program by</span>
<span style="color: #02FF02">        Finding it in Reltio, or Validate the</span>
<span style="color: #02FF02">        Domain by Querying its MX Records.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;mail&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">verify</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">valid_domain</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> ) :
                <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Deny - Invalid Email Address&#39;</span>
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;rate&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">valid_program</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
                                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">reltio_rates</span> ) :
                <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Pending - Rate not Found in &#39;</span> <span style="color: #FF8000">+</span>\
                           <span style="color: #02FF02">&#39;Current Source HPP Data. &#39;</span>    <span style="color: #FF8000">+</span>\
                           <span style="color: #02FF02">&#39;DSR will Revisit this Item.&#39;</span>
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF8000">raise</span> <span style="color: #FFFFFF">ValueError</span>(
            <span style="color: #02FF02">&#39;The positional argument &quot;issueid&quot; must be &#39;</span> <span style="color: #FF8000">+</span>\
            <span style="color: #02FF02">&#39;of type string containing &quot;rate&quot; or &quot;mail.&quot;&#39;</span> )

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">assoc_comp</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">None</span> ):
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Third Step: Search and Seize the Name</span>
<span style="color: #02FF02">        of the Organization that&#39;s Associated</span>
<span style="color: #02FF02">        with the Analyte.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> :
            <span style="color: #FFFFFF">comps</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_org</span>( <span style="color: #FFFFFF">name</span> )
        <span style="color: #FF8000">elif</span> <span style="color: #02FF02">&#39;mail&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FFFFFF">comps</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">scrape</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">assoc_comp</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FFFFFF">comps</span> :
                <span style="color: #FFFFFF">comps</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">split</span>( <span style="color: #02FF02">&#39;.&#39;</span> )[ <span style="color: #FF00FF">0</span> ] )
                <span style="color: #FFFFFF">comps</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span> )
        <span style="color: #FF8000">elif</span> <span style="color: #02FF02">&#39;rate&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> :
            <span style="color: #FFFFFF">comps</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #DD0000"># From valid_program</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FFFFFF">comps</span> ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">5</span> :
            <span style="color: #DD0000"># Don&#39;t want to spend an hour here</span>
            <span style="color: #FFFFFF">comps</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">comps</span>[ <span style="color: #FF00FF">0</span> : <span style="color: #FF00FF">5</span> ]
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">acnt</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">comps</span> :
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">fuzz</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">QRatio</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">acnt</span> ) <span style="color: #FF8000">!=</span> <span style="color: #FF00FF">100</span> :
                <span style="color: #DD0000"># Correct for minor mispellings</span>
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">fuzz</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">QRatio</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>, <span style="color: #FFFFFF">acnt</span> ) <span style="color: #FF8000">&gt;=</span> <span style="color: #FF00FF">90</span> :
                    <span style="color: #FFFFFF">comps</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span> )
                    <span style="color: #FF8000">break</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> :
            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">comps</span> :
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Parent Account&#39;</span> ] :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Parent Account&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">name</span> )
        <span style="color: #FF8000">else</span> :
            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">comps</span> :
                <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Associated Account&#39;</span> ] :
                    <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Associated Account&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">name</span> )
        <span style="color: #FF8000">return</span> <span style="color: #FFFFFF">comps</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">name_in_aw</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">name</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Fourth Step: Query name in AW to find</span>
<span style="color: #02FF02">        whether it exists in the database.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #DD0000"># Avoid querying small substrings</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FFFFFF">name</span> ) <span style="color: #FF8000">&gt;</span>  <span style="color: #FF00FF">6</span> : <span style="color: #FFFFFF">suff</span> <span style="color: #FF8000">=</span>  <span style="color: #FF69B4">True</span>
        <span style="color: #FF8000">else</span>                : <span style="color: #FFFFFF">suff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">len</span>( <span style="color: #FFFFFF">name</span> ) <span style="color: #FF8000">&gt;</span> <span style="color: #FF00FF">14</span> : <span style="color: #FFFFFF">like</span> <span style="color: #FF8000">=</span>  <span style="color: #FF69B4">True</span>
        <span style="color: #FF8000">else</span>                : <span style="color: #FFFFFF">like</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #DD0000"># A common error is to not include</span>
        <span style="color: #DD0000"># spaces or include unnecessary spaces</span>
        <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">name</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">replace</span>( <span style="color: #02FF02">&#39; &#39;</span>, <span style="color: #02FF02">&#39;&#39;</span> )
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_db</span>( <span style="color: #FFFFFF">name</span>, <span style="color: #FFFFFF">like</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">like</span>,
                                  <span style="color: #FFFFFF">suffix</span>  <span style="color: #FF8000">=</span>  <span style="color: #FFFFFF">suff</span>,
                                  <span style="color: #FFFFFF">spaces</span>  <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>,
                                  <span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span>  <span style="color: #FF69B4">True</span> ) :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span>
            <span style="color: #FFFFFF">cols</span> <span style="color: #FF8000">=</span> [ <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span>
                     <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">columns</span>
                     <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;DUNS&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> ]
            <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span>[ <span style="color: #FFFFFF">cols</span> ]
            <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">!=</span> <span style="color: #02FF02">&#39;&#39;</span>
            <span style="color: #FFFFFF">duns</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">duns</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">any</span>( <span style="color: #FFFFFF">axis</span> <span style="color: #FF8000">=</span> <span style="color: #FF00FF">1</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FFFFFF">duns</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">any</span>( <span style="color: #FFFFFF">axis</span> <span style="color: #FF8000">=</span> <span style="color: #FF00FF">0</span> ) :
                <span style="color: #DD0000"># Accounts not at all associated with</span>
                <span style="color: #DD0000"># a D-U-N-S number are not reliable</span>
                <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">loc</span>[
                <span style="color: #FFFFFF">duns</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>(), : ]
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">name</span>
            <span style="color: #FF8000">else</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entityresult</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span>
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_title</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">name</span>   
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
        <span style="color: #DD0000"># Not in AW</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">link_analyte</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">name</span> ):
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Fifth Step: Link analyte to best name</span>
<span style="color: #02FF02">        match in AW at the highest level</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">name</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">replace</span>( <span style="color: #02FF02">&#39; &#39;</span>, <span style="color: #02FF02">&#39;&#39;</span> )
        <span style="color: #FFFFFF">query</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span>
        <span style="color: #FFFFFF">link</span>  <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">lowest_level_deduped</span>(
            <span style="color: #FFFFFF">name</span>, <span style="color: #FFFFFF">query</span>, <span style="color: #FFFFFF">spaces</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
            )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">blowup_web</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Sixth Step: Blowup sales hierarchy of</span>
<span style="color: #02FF02">        the linked organization name</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>
        <span style="color: #DD0000"># Retrieve name as it is written in AW</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">link</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> :
            <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;NM&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> :
                <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">col</span>
                <span style="color: #FF8000">break</span>
        <span style="color: #FFFFFF">acnt</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">link</span>[ <span style="color: #FFFFFF">colm</span> ]
        <span style="color: #DD0000"># Store name</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> :
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">acnt</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Parent Acc. in AW&#39;</span> ] :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Parent Acc. in AW&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">acnt</span> )
        <span style="color: #FF8000">else</span> :
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">acnt</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Assoc. Acc. in AW&#39;</span> ]:
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Assoc. Acc. in AW&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">acnt</span> )
        <span style="color: #DD0000"># Blow up hierarchy</span>
        <span style="color: #FFFFFF">web</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">blowup</span>( <span style="color: #FFFFFF">acnt</span>, <span style="color: #FFFFFF">only_duns</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>,
                                 <span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span> )
        <span style="color: #DD0000"># Store hierarchy</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">ultm</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">query</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">ultm</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">values</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>():
            <span style="color: #FFFFFF">ultm</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;, &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FFFFFF">ultm</span> )
            <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">ultm</span> <span style="color: #FF8000">not</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Hierarchy&#39;</span> ] :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Hierarchy&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">ultm</span> )
        <span style="color: #FF8000">return</span> <span style="color: #FFFFFF">web</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">acnt_in_web</span>( <span style="color: #FF69B4">self</span>, <span style="color: #FFFFFF">web</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Seventh Step: Search the account name</span>
<span style="color: #02FF02">        in the sales hierarchy of linked name.</span>
<span style="color: #02FF02">        Web is short for hierarchy.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #FFFFFF">web</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> : <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FFFFFF">name</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">replace</span>( <span style="color: #02FF02">&#39; &#39;</span>, <span style="color: #02FF02">&#39;&#39;</span> )
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tools</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_web</span>( <span style="color: #FFFFFF">name</span>, <span style="color: #FFFFFF">web</span>,
                                   <span style="color: #FFFFFF">spaces</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span> ) :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">True</span>
            <span style="color: #FF8000">return</span> <span style="color: #FF69B4">True</span>
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">False</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">resolution</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Last Step: Check the archive file and</span>
<span style="color: #02FF02">        validate link, append cache with link</span>
<span style="color: #02FF02">        resolution, &quot;wrap up&quot; the information</span>
<span style="color: #02FF02">        store, and then return the resolution.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #DD0000"># Check and, if link was found,</span>
        <span style="color: #DD0000"># validate archive</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validate_archive</span>()
        <span style="color: #DD0000"># Find you a link!</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">find_linkage</span>()
        <span style="color: #DD0000"># Store found linkage</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">empty</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Program Could Not Find Link&#39;</span>
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Found Link&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> )
        <span style="color: #FF8000">else</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">link_duns</span>()
            <span style="color: #FFFFFF">link</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;, &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">tolist</span>() )
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Found Link&#39;</span> ]<span style="color: #FF8000">.</span><span style="color: #FFFFFF">append</span>( <span style="color: #FFFFFF">link</span> )
            <span style="color: #DD0000"># If link has no D-U-N-S number,</span>
            <span style="color: #DD0000"># contact account deployment.</span>
            <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">col</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">index</span> :
                <span style="color: #FF8000">if</span> <span style="color: #02FF02">&#39;DUNS&#39;</span> <span style="color: #FF8000">in</span> <span style="color: #FFFFFF">col</span> :
                    <span style="color: #FFFFFF">colm</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">col</span>
                    <span style="color: #FF8000">break</span>
            <span style="color: #FF8000">if</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>[ <span style="color: #FFFFFF">colm</span> ] <span style="color: #FF8000">==</span> <span style="color: #02FF02">&#39;&#39;</span> :
                <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">+=</span> <span style="color: #02FF02">&#39; - Contact Account Deployment&#39;</span>
        <span style="color: #FF8000">if</span> <span style="color: #FF8000">not</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> :
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;Program Could Not Validate&#39;</span>
        <span style="color: #DD0000"># Append cache</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">links</span>[ ( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>,
                      <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
                      <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> )
                  ] <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resol</span>[ ( <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">account</span>,
                      <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte</span>,
                      <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">issueid</span> )
                  ] <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span>
        <span style="color: #DD0000"># Finalize information store</span>
        <span style="color: #FF8000">for</span> <span style="color: #FFFFFF">key</span> <span style="color: #FF8000">in</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">keys</span>():
            <span style="color: #FFFFFF">val</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #FFFFFF">key</span> ]
            <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #FFFFFF">key</span> ] <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39; | &#39;</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">join</span>( <span style="color: #FFFFFF">val</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span>[ <span style="color: #02FF02">&#39;Resolution&#39;</span> ] <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span>
        <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">set_option</span>( <span style="color: #02FF02">&#39;display.max_colwidth&#39;</span>, <span style="color: #FF00FF">10000</span> )
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>(
            <span style="color: #FFFFFF">index</span>   <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">keys</span>(),
            <span style="color: #FFFFFF">data</span>    <span style="color: #FF8000">=</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">values</span>(),
            <span style="color: #FFFFFF">columns</span> <span style="color: #FF8000">=</span> [ <span style="color: #02FF02">&#39;Info&#39;</span> ] )
        <span style="color: #DD0000"># End</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">track</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">clear</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">logtime</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">total</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">endpage</span>()
        <span style="color: #FF8000">return</span> <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span>

    <span style="color: #FF8000">def</span> <span style="color: #5E5EFF">reset</span>( <span style="color: #FF69B4">self</span> ) :
        <span style="color: #02FF02">&#39;&#39;&#39;</span>
<span style="color: #02FF02">        Helper Function:</span>
<span style="color: #02FF02">        Reset processing parameters.</span>
<span style="color: #02FF02">        &#39;&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">resolve</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">handoff</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parents</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">orphans</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">linkage</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">Series</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">archive</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">Series</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_title</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_title</span> <span style="color: #FF8000">=</span> <span style="color: #02FF02">&#39;&#39;</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">analyte_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">validarchive</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_arch</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">acnt_in_link</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parent_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entity_in_aw</span> <span style="color: #FF8000">=</span> <span style="color: #FF69B4">False</span>
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">parentresult</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">entityresult</span> <span style="color: #FF8000">=</span> <span style="color: #FFFFFF">pd</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">DataFrame</span>()
        <span style="color: #FF69B4">self</span><span style="color: #FF8000">.</span><span style="color: #FFFFFF">info</span> <span style="color: #FF8000">=</span> {
            <span style="color: #02FF02">&#39;Associated Account&#39;</span> : [], <span style="color: #02FF02">&#39;Assoc. Acc. in AW&#39;</span> : [],
            <span style="color: #02FF02">&#39;Parent Account&#39;</span>     : [], <span style="color: #02FF02">&#39;Parent Acc. in AW&#39;</span> : [],
            <span style="color: #02FF02">&#39;Found Link&#39;</span>         : [], <span style="color: #02FF02">&#39;Hierarchy&#39;</span>         : [],
            <span style="color: #02FF02">&#39;Archived Link&#39;</span>      : [], <span style="color: #02FF02">&#39;Archived Hierarchy&#39;</span>: [],
            <span style="color: #02FF02">&#39;Resolution&#39;</span>         : []
            }
</pre></div>
</td></tr></table>
    </div>
  </body>
</html>
